{"ast":null,"code":"import { BehaviorSubject, Subject, debounceTime, delay, of, switchMap, tap } from 'rxjs';\nimport { orderTableData } from '../data/data/ecommerce/order-history';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nconst compare = (v1, v2) => v1 < v2 ? -1 : v1 > v2 ? 1 : 0;\nfunction sort(orderHistory, columns, direction) {\n  if (direction === '' || columns === '') {\n    return orderHistory;\n  } else {\n    return [...orderHistory].sort((c, f) => {\n      const res = compare(c[columns], f[columns]);\n      return direction === 'asc' ? res : -res;\n    });\n  }\n}\nfunction matches(orders, term, pipe) {\n  return orders.product.toLowerCase().includes(term.toLowerCase()) || orders.status.toLowerCase().includes(term.toLowerCase()) || orders.size.toLowerCase().includes(term.toLowerCase()) || orders.class.toLowerCase().includes(term.toLowerCase()) || orders.color.toLowerCase().includes(term.toLowerCase()) || pipe.transform(orders.units).includes(term) || pipe.transform(orders.articleNumber).includes(term) || pipe.transform(orders.price).includes(term);\n}\nexport class OrderHistoryService {\n  constructor(pipe) {\n    this.pipe = pipe;\n    this._loading$ = new BehaviorSubject(true);\n    this._search$ = new Subject();\n    this._ordersList$ = new BehaviorSubject([]);\n    this._total$ = new BehaviorSubject(0);\n    this._product = {\n      page: 1,\n      pageSize: 10,\n      searchTerm: '',\n      sortColumn: '',\n      sortDirection: ''\n    };\n    this._search$.pipe(tap(() => this._loading$.next(true)), debounceTime(200), switchMap(() => this._search()), delay(200), tap(() => this._loading$.next(false))).subscribe(result => {\n      this._ordersList$.next(result.products);\n      this._total$.next(result.total);\n    });\n    this._search$.next();\n  }\n  get orderList$() {\n    return this._ordersList$.asObservable();\n  }\n  get total$() {\n    return this._total$.asObservable();\n  }\n  get loading$() {\n    return this._loading$.asObservable();\n  }\n  get page() {\n    return this._product.page;\n  }\n  get pageSize() {\n    return this._product.pageSize;\n  }\n  get searchTerm() {\n    return this._product.searchTerm;\n  }\n  set page(page) {\n    this._set({\n      page\n    });\n  }\n  set pageSize(pageSize) {\n    this._set({\n      pageSize\n    });\n  }\n  set searchTerm(searchTerm) {\n    this._set({\n      searchTerm\n    });\n  }\n  set sortColumn(sortColumn) {\n    this._set({\n      sortColumn\n    });\n  }\n  set sortDirection(sortDirection) {\n    this._set({\n      sortDirection\n    });\n  }\n  _set(patch) {\n    Object.assign(this._product, patch);\n    this._search$.next();\n  }\n  _search() {\n    const {\n      sortColumn,\n      sortDirection,\n      pageSize,\n      page,\n      searchTerm\n    } = this._product;\n    // 1. sort\n    let products = sort(orderTableData, sortColumn, sortDirection);\n    // 2. filter\n    products = products.filter(list => matches(list, searchTerm, this.pipe));\n    const total = products.length;\n    // 3. paginate\n    products = products.slice((page - 1) * pageSize, (page - 1) * pageSize + pageSize);\n    return of({\n      products,\n      total\n    });\n  }\n  static #_ = this.ɵfac = function OrderHistoryService_Factory(t) {\n    return new (t || OrderHistoryService)(i0.ɵɵinject(i1.DecimalPipe));\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: OrderHistoryService,\n    factory: OrderHistoryService.ɵfac,\n    providedIn: 'root'\n  });\n}","map":{"version":3,"names":["BehaviorSubject","Subject","debounceTime","delay","of","switchMap","tap","orderTableData","compare","v1","v2","sort","orderHistory","columns","direction","c","f","res","matches","orders","term","pipe","product","toLowerCase","includes","status","size","class","color","transform","units","articleNumber","price","OrderHistoryService","constructor","_loading$","_search$","_ordersList$","_total$","_product","page","pageSize","searchTerm","sortColumn","sortDirection","next","_search","subscribe","result","products","total","orderList$","asObservable","total$","loading$","_set","patch","Object","assign","filter","list","length","slice","_","i0","ɵɵinject","i1","DecimalPipe","_2","factory","ɵfac","providedIn"],"sources":["C:\\Repository\\Jupiter\\juno-app\\src\\app\\shared\\services\\order-history.service.ts"],"sourcesContent":["import { DecimalPipe } from '@angular/common';\nimport { Injectable, PipeTransform } from '@angular/core';\nimport { BehaviorSubject, Observable, Subject, debounceTime, delay, of, switchMap, tap } from 'rxjs';\nimport { orderTable, orderTableData } from '../data/data/ecommerce/order-history';\nimport { SortColumn, SortDirection } from '../directive/order-historay-sortable.directive';\n\ninterface SearchResult {\n\tproducts: orderTable[];\n\ttotal: number;\n  }\n  \ninterface State {\n  page: number;\n  pageSize: number;\n  searchTerm: string;\n  sortColumn: SortColumn;\n  sortDirection: SortDirection;\n}\n\nconst compare = (v1: string | number, v2: string | number) => (v1 < v2 ? -1 : v1 > v2 ? 1 : 0);\n\nfunction sort(orderHistory: orderTable[], columns: SortColumn, direction: string): orderTable[] {\n\tif (direction === '' || columns === '') {\n\t  return orderHistory;\n\t} else {\t\n\t  return [...orderHistory].sort((c, f) => {\n\t\tconst res = compare(c[columns], f[columns]);\n\t\treturn direction === 'asc' ? res : -res;\n\t  });\n\t}\n  }\n\n\nfunction matches(orders: orderTable, term: string, pipe: PipeTransform) {\n  return (\n    orders.product.toLowerCase().includes(term.toLowerCase())  ||\n    orders.status.toLowerCase().includes(term.toLowerCase())  ||\n    orders.size.toLowerCase().includes(term.toLowerCase())  ||\n    orders.class.toLowerCase().includes(term.toLowerCase())  ||\n    orders.color.toLowerCase().includes(term.toLowerCase())  ||\n\tpipe.transform(orders.units).includes(term)  ||\n\tpipe.transform(orders.articleNumber).includes(term) ||\n\tpipe.transform(orders.price).includes(term) \n  )\n    \n}\n\n@Injectable({\n  providedIn: 'root'\n})\n\nexport class OrderHistoryService {\n\n  private _loading$ = new BehaviorSubject<boolean>(true);\n  private _search$ = new Subject<void>();\n  private _ordersList$ = new BehaviorSubject<orderTable[]>([]);\n  private _total$ = new BehaviorSubject<number>(0);\n\n  private _product: State = {\n    page: 1,\n    pageSize: 10,\n    searchTerm: '',\n    sortColumn: '',\n    sortDirection: '',\n  };\n\n  constructor(private pipe: DecimalPipe) {\n    this._search$\n      .pipe(\n        tap(() => this._loading$.next(true)),\n        debounceTime(200),\n        switchMap(() => this._search()),\n        delay(200),\n        tap(() => this._loading$.next(false)),\n      )\n      .subscribe((result) => {\n        this._ordersList$.next(result.products);\n        this._total$.next(result.total);\n      });\n    this._search$.next();\n  }\n\n\n\n  get orderList$() {\n\t\treturn this._ordersList$.asObservable();\n\t}\n\tget total$() {\n\t\treturn this._total$.asObservable();\n\t}\n\tget loading$() {\n\t\treturn this._loading$.asObservable();\n\t}\n\tget page() {\n\t\treturn this._product.page;\n\t}\n\tget pageSize() {\n\t\treturn this._product.pageSize;\n\t}\n\tget searchTerm() {\n\t\treturn this._product.searchTerm;\n\t}\n\n\tset page(page: number) {\n\t\tthis._set({ page });\n\t}\n\tset pageSize(pageSize: number) {\n\t\tthis._set({ pageSize });\n\t}\n\tset searchTerm(searchTerm: string) {\n\t\tthis._set({ searchTerm });\n\t}\n\tset sortColumn(sortColumn: SortColumn) {\n\t\tthis._set({ sortColumn });\n\t}\n\tset sortDirection(sortDirection: SortDirection) {\n\t\tthis._set({ sortDirection });\n\t}\n\n\tprivate _set(patch: Partial<State>) {\n\t\tObject.assign(this._product, patch);\n\t\tthis._search$.next();\n\t}\n\n\tprivate _search(): Observable<SearchResult> {\n\t\tconst { sortColumn, sortDirection, pageSize, page, searchTerm } = this._product;\n\n\t\t// 1. sort\n\t\tlet products = sort(orderTableData, sortColumn, sortDirection);\n\n\t\t// 2. filter\n\t\tproducts = products.filter((list) => matches(list, searchTerm, this.pipe));\n\t\tconst total = products.length;\n\n\t\t// 3. paginate\n\t\tproducts = products.slice((page - 1) * pageSize, (page - 1) * pageSize + pageSize);\n\t\treturn of({ products, total });\n\t}\n  \n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}